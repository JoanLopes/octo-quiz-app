{% extends "base.html" %}

{% block content %}
<div class="max-w-6xl mx-[20%] mt-16 px-4" x-data="deckList('{{ token }}')" x-init="fetchDecks()">

  <div class="text-center mb-10">
    <h1 class="text-4xl font-extrabold text-indigo-700">Meus Decks</h1>
    <p class="text-gray-600 mt-2">Gerencie seus conjuntos de flashcards de forma rápida e prática.</p>
  </div>

  <div class="text-right mb-6">
    <a href="{% url 'deck-create-page' %}"
       class="inline-block px-6 py-2 rounded bg-indigo-600 text-white font-semibold hover:bg-indigo-700 transition">
      + Novo Deck
    </a>
  </div>

  <template x-if="loading">
    <p class="text-center text-gray-500 italic">Carregando decks...</p>
  </template>

  <template x-if="!loading && decks.length === 0">
    <p class="text-center text-gray-500 italic">Nenhum deck encontrado.</p>
  </template>

  <div class="space-y-6">
    <template x-for="deck in decks" :key="deck.id">
      <div
        class="border border-indigo-200 bg-white rounded-lg p-5 shadow hover:shadow-md transition flex flex-col md:flex-row justify-between items-start md:items-center">
        <div>
          <h2 class="text-xl font-semibold text-indigo-900" x-text="deck.name"></h2>
          <p class="text-gray-700 mt-1" x-text="deck.description || 'Sem descrição'"></p>
        </div>
        <div class="mt-4 md:mt-0 space-x-2">
          <a :href="`/decks/${deck.id}/edit/`"
             class="inline-block px-4 py-1 rounded bg-yellow-400 text-yellow-900 font-semibold hover:bg-yellow-500 transition">
            Editar
          </a>
          <a :href="`/decks/${deck.id}/delete/`"
             class="inline-block px-4 py-1 rounded bg-red-500 text-white font-semibold hover:bg-red-600 transition">
            Excluir
          </a>
        </div>
      </div>
    </template>
  </div>

</div>

<script>
  function deckList(token) {
    return {
      loading: true,
      decks: [],
      async fetchDecks() {
        try {
          const res = await fetch('/api/decks/', {
            headers: {
              'Content-Type': 'application/json',
              ...(token && { 'Authorization': `Bearer ${token}` })
            }
          });
          if (!res.ok) throw new Error('Erro ao buscar decks');
          this.decks = await res.json();
        } catch (e) {
          console.error('Erro ao carregar decks:', e);
          this.decks = [];
        } finally {
          this.loading = false;
        }
      }
    }
  }
</script>
{% endblock %}
